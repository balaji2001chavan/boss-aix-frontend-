import express from "express";
import cors from "cors";
import bodyParser from "body-parser";

const app = express();

// â¤ï¸ CORS â€“ FIX FOR RENDER FRONTEND
app.use(cors({
  origin: "*",            // allow all
  methods: "GET,POST",    // what methods allowed
  allowedHeaders: "Content-Type"
}));

app.use(bodyParser.json());

// TEST ROOT
app.get("/", (req, res) => {
  res.json({ ok: true, msg: "Boss AIX Backend LIVE" });
});

// MAIN API used by frontend
app.post("/api/aix", (req, res) => {
  try {
    const { message } = req.body;

    if (!message) {
      return res.json({ reply: "à¤®à¤²à¤¾ à¤•à¤¾à¤¯ à¤¸à¤¾à¤‚à¤—à¤¾à¤¯à¤šà¥‡ à¤¤à¥‡ à¤¬à¥‹à¤²à¤¾ à¤¬à¥‰à¤¸ â¤ï¸" });
    }

    // TEMP dummy smart reply
    return res.json({
      reply: `à¤¬à¥‰à¤¸, à¤®à¥€ à¤à¤•à¤¤ à¤†à¤¹à¥‡: "${message}". AIX à¤ªà¥‚à¤°à¥à¤£ à¤¸à¥à¤®à¤¾à¤°à¥à¤Ÿ à¤®à¥‹à¤¡à¤®à¤§à¥à¤¯à¥‡ à¤†à¤¹à¥‡ ðŸ”¥`
    });

  } catch (err) {
    console.error(err);
    res.status(500).json({ reply: "AIX ERROR: Backend crash à¤à¤¾à¤²à¤¾" });
  }
});

// PORT
const PORT = process.env.PORT || 5000;
app.listen(PORT, () => {
  console.log("Boss AIX Backend running on PORT", PORT);
});
